---
title: "POMA: R Package for Statistical Analysis of Mass Spectrometry Data"
author: "Pol Castellano-Escuder"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    toc_depth: 4
    number_sections: true
vignette: >
  %\VignetteIndexEntry{POMA: R Package for Statistical Analysis of Mass Spectrometry Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  dpi = 300,
  fig.align = "center",
  fig.height = 5,
  fig.width = 8
)
```

# Installation

```{r, eval = FALSE}
# install.packages("devtools")
devtools::install_github("pcastellanoescuder/POMA")
```

# Load POMA

```{r, warning = FALSE}
library(POMA)
```

# Load or Create an `MSnbase::MSnSet()` object

## Load example data

```{r}
data(st000284)
st000284
```

## Create the data

We can load an `MSnSet` object directly or we can create our own object from matrix and/or data frames using `PomaMSnSetClass` function. See:

```{r}
# object <- PomaMSnSetClass(features = my_features, target = my_target)
```

# Pre Processing

## Missing Value Imputation

Often in mass spectometry analyses we have to deal with some missing values in our data. To face this in **POMA** just run the following line of code to impute your missings!

```{r}
imputed <- PomaImpute(st000284, ZerosAsNA = T, RemoveNA = T, cutoff = 20, method = "knn")
imputed
```

_Note that the object has been updated with imputation information._

## Normalization

The next step is the **normalization** of the data. Again, **POMA** offers several methods to normalize the data by running just one line of code:

```{r}
normalized <- PomaNorm(imputed, method = "log_pareto")
normalized
```

_Note that the object has been updated with normalization information._

### Normalization effect

Sometimes, we could be interested in _how the normalization process has affected our data_?  

To answer this question, **POMA** offers two exploratory functions, `PomaNormPlot` and `PomaDensity`, that can help to understand the normalization process.

`PomaNormPlot` generates boxplots for all samples or features (depending on the group factor) of an `MSnSet` object.

```{r, fig.height = 5, fig.width = 8}
PomaNormPlot(imputed, group = "samples") # data before normalization
```

```{r, fig.height = 5, fig.width = 8}
PomaNormPlot(normalized, group = "samples") # data after normalization
```

On the other hand, `PomaDensity` shows the distribution of all features before and after the normalization process. 

```{r, fig.height = 5, fig.width = 8}
PomaDensity(imputed, group = "features") # data before normalization
```


```{r, fig.height = 5, fig.width = 8}
PomaDensity(normalized, group = "features") # data after normalization
```

# Statistical Analysis

## Principal Component Analysis

```{r}
multiv_pca <- PomaMultivariate(normalized, 
                               method = "pca",
                               components = 5,
                               scale = FALSE,
                               center = FALSE)
```

## Scree Plot

```{r}
multiv_pca$screeplot
```

## Scores Plot

```{r}
multiv_pca$scoresplot
```

## Score Table

```{r}
head(multiv_pca$score_data)
```


